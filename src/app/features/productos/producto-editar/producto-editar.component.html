<div class="page">
  <a routerLink="/productos" class="back">← Volver a productos</a>
  <h1>Editar producto</h1>
  @if (loading) {
    <p>Cargando...</p>
  } @else {
    <div class="form-card">
      <form (ngSubmit)="guardar()">
        <div class="form-row">
          <label>Precio venta sugerido</label>
          <input type="number" [(ngModel)]="form.precio_venta_sugerido" name="precio_venta_sugerido" min="0" step="0.01" />
        </div>
        <div class="form-row">
          <label>Código interno *</label>
          <input [(ngModel)]="form.codigo_interno" name="codigo_interno" required />
        </div>
        <div class="form-row">
          <label>Descripción *</label>
          <input [(ngModel)]="form.descripcion" name="descripcion" required />
        </div>
        <div class="form-row">
          <label>Nombre</label>
          <input [(ngModel)]="form.nombre" name="nombre" />
        </div>
        <div class="form-row">
          <label>Categoría</label>
          <select [(ngModel)]="form.categoria_id" name="categoria_id" (ngModelChange)="onCategoriaChange()">
            <option [ngValue]="null">-- Seleccionar --</option>
            @for (c of categorias; track c.categoria_id) {
              <option [ngValue]="c.categoria_id">{{ c.nombre }}</option>
            }
          </select>
        </div>
        <div class="form-row">
          <label>Subcategoría</label>
          <select [(ngModel)]="form.subcategoria_id" name="subcategoria_id">
            <option [ngValue]="null">-- Seleccionar --</option>
            @for (s of subcategorias; track s.subcategoria_id) {
              <option [ngValue]="s.subcategoria_id">{{ s.nombre }}</option>
            }
          </select>
        </div>
        <p class="hint">Para actualizar el stock, usa el botón "Stock" en la lista de productos.</p>
        <div class="form-row">
          <label>Estatus</label>
          <select [(ngModel)]="form.estatus" name="estatus">
            <option value="A">Activo</option>
            <option value="C">Cancelado</option>
          </select>
        </div>
        @if (errorMsg) {
          <p class="error-msg">{{ errorMsg }}</p>
        }
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelar()">Cancelar</button>
          <button type="submit" class="btn-primary" [disabled]="saving">{{ saving ? 'Guardando...' : 'Guardar' }}</button>
        </div>
      </form>
    </div>
  }
</div>

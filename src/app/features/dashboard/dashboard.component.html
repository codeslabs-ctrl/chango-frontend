<div class="dashboard">
  <section class="table-section">
    <h2><span class="page-icon">‚è≥</span> Ventas por confirmar</h2>
    <div class="table-filter">
      <input type="text" [(ngModel)]="filterVentas" (input)="ventasCurrentPage = 1" placeholder="Buscar por cliente, tel√©fono, productos..." />
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Tel√©fono</th>
            <th>Productos</th>
            <th>Monto</th>
            <th>Fecha</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @if (ventasFiltradas.length === 0 && !loadingVentas) {
            <tr><td colspan="6" class="empty">No hay ventas pendientes</td></tr>
          }
          @for (v of ventasPaginadas; track v.venta_id) {
            <tr>
              <td>{{ v.cliente_nombre || '-' }}</td>
              <td>{{ v.cliente_telefono || '-' }}</td>
              <td>{{ v.productos_nombres || '-' }}</td>
              <td>{{ v.total_venta | number:'1.2-2' }}</td>
              <td>{{ v.fecha_venta | date:'short' }}</td>
              <td class="actions-cell">
                <div class="actions-cell-inner">
                <button class="btn-confirm" (click)="confirmar(v.venta_id)" [disabled]="confirmando === v.venta_id">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                  Confirmar
                </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
      @if (ventasFiltradas.length > ventasPageSize) {
        <div class="pagination-wrapper">
          <div class="pagination">
          <button (click)="ventasCurrentPage = 1" [disabled]="ventasCurrentPage === 1">¬´</button>
          <button (click)="ventasCurrentPage = ventasCurrentPage - 1" [disabled]="ventasCurrentPage === 1">‚Äπ</button>
          <span>P√°gina {{ ventasCurrentPage }} de {{ ventasTotalPages }}</span>
          <button (click)="ventasCurrentPage = ventasCurrentPage + 1" [disabled]="ventasCurrentPage === ventasTotalPages">‚Ä∫</button>
          <button (click)="ventasCurrentPage = ventasTotalPages" [disabled]="ventasCurrentPage === ventasTotalPages">¬ª</button>
          </div>
        </div>
      }
    </div>
  </section>

  <section class="table-section">
    <h2><span class="page-icon">üì¶</span> Inventario de productos</h2>
    <div class="table-filter">
      <input type="text" [(ngModel)]="filterProductos" (input)="productosCurrentPage = 1" placeholder="Buscar por producto, categor√≠a..." />
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Categor√≠a</th>
            <th>Inventario actual</th>
            <th>Estatus</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @if (productosFiltrados.length === 0 && !loadingProductos) {
            <tr><td colspan="6" class="empty">No hay productos</td></tr>
          }
          @for (p of productosPaginados; track p.producto_id) {
            <tr>
              <td>{{ p.descripcion || p.nombre || p.codigo_interno }}</td>
              <td>{{ p.subcategoria_nombre || '-' }}</td>
              <td>{{ p.existencia_actual }}</td>
              <td><span class="badge" [class.activo]="(p.estatus || 'A') === 'A'" [class.cancelado]="(p.estatus || 'A') === 'C'">{{ (p.estatus || 'A') === 'A' ? 'Activo' : 'Cancelado' }}</span></td>
              <td class="actions-cell">
                <div class="actions-cell-inner">
                <a [routerLink]="['/productos']" [queryParams]="{ stock: p.producto_id }" class="btn-icon" title="Actualizar stock">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                  <span>Stock</span>
                </a>
                <a [routerLink]="['/productos', p.producto_id, 'editar']" class="btn-icon" title="Editar producto">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                  <span>Editar</span>
                </a>
                <button class="btn-toggle" (click)="toggleEstatusProducto(p)" [title]="(p.estatus || 'A') === 'A' ? 'Deshabilitar' : 'Habilitar'">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
                  {{ (p.estatus || 'A') === 'A' ? 'Deshabilitar' : 'Habilitar' }}
                </button>
                @if (!p.tiene_ventas) {
                  <button class="btn-danger" (click)="eliminarProducto(p)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                    Eliminar
                  </button>
                }
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
      @if (productosFiltrados.length > productosPageSize) {
        <div class="pagination-wrapper">
          <div class="pagination">
          <button (click)="productosCurrentPage = 1" [disabled]="productosCurrentPage === 1">¬´</button>
          <button (click)="productosCurrentPage = productosCurrentPage - 1" [disabled]="productosCurrentPage === 1">‚Äπ</button>
          <span>P√°gina {{ productosCurrentPage }} de {{ productosTotalPages }}</span>
          <button (click)="productosCurrentPage = productosCurrentPage + 1" [disabled]="productosCurrentPage === productosTotalPages">‚Ä∫</button>
          <button (click)="productosCurrentPage = productosTotalPages" [disabled]="productosCurrentPage === productosTotalPages">¬ª</button>
          </div>
        </div>
      }
    </div>
  </section>
</div>

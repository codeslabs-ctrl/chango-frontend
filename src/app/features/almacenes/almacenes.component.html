<div class="page">
  <h1><span class="page-icon">üè™</span> Gestionar Almacenes</h1>
  <div class="actions">
    <button class="btn-primary" (click)="openAddForm()">+ A√±adir almac√©n</button>
  </div>

  @if (showForm) {
    <div class="form-card">
      <h3>{{ editingAlmacen ? 'Editar' : 'Nuevo' }} almac√©n</h3>
      <form (ngSubmit)="saveAlmacen()">
        <div class="form-row">
          <label>Nombre *</label>
          <input [(ngModel)]="form.nombre" name="nombre" required />
        </div>
        <div class="form-row">
          <label>Ubicaci√≥n</label>
          <input [(ngModel)]="form.ubicacion" name="ubicacion" />
        </div>
        <div class="form-row">
          <label>Estatus</label>
          <select [(ngModel)]="form.estatus" name="estatus">
            <option value="A">Activo</option>
            <option value="C">Inactivo</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelForm()">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  }

  <div class="table-filter">
    <input type="text" [(ngModel)]="filterAlmacenes" (input)="currentPage = 1" placeholder="Buscar por nombre, ubicaci√≥n..." />
  </div>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Ubicaci√≥n</th>
          <th>Estatus</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @if (almacenesFiltrados.length === 0 && !loading) {
          <tr><td colspan="5" class="empty">No hay almacenes</td></tr>
        }
        @for (a of almacenesPaginados; track a.almacen_id) {
          <tr>
            <td>{{ a.almacen_id }}</td>
            <td>{{ a.nombre }}</td>
            <td>{{ a.ubicacion || '-' }}</td>
            <td><span class="badge" [class.activo]="(a.estatus || 'A') === 'A'" [class.inactivo]="(a.estatus || 'A') === 'C'">{{ (a.estatus || 'A') === 'A' ? 'Activo' : 'Inactivo' }}</span></td>
            <td class="actions-cell">
              <div class="actions-cell-inner">
                <button class="btn-icon" (click)="edit(a)" title="Editar">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                <span>Editar</span>
                </button>
                <a [routerLink]="['/almacenes', a.almacen_id]" class="btn-small">Productos</a>
                <button class="btn-toggle" (click)="toggleEstatus(a)" [title]="(a.estatus || 'A') === 'A' ? 'Deshabilitar' : 'Habilitar'">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
                {{ (a.estatus || 'A') === 'A' ? 'Deshabilitar' : 'Habilitar' }}
                </button>
                @if (!a.tiene_productos) {
                  <button class="btn-small btn-danger" (click)="eliminar(a)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                  Eliminar
                  </button>
                }
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
    @if (almacenesFiltrados.length > pageSize) {
      <div class="pagination-wrapper">
        <div class="pagination">
          <button (click)="currentPage = 1" [disabled]="currentPage === 1">¬´</button>
          <button (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">‚Äπ</button>
          <span>P√°gina {{ currentPage }} de {{ totalPages }}</span>
          <button (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages">‚Ä∫</button>
          <button (click)="currentPage = totalPages" [disabled]="currentPage === totalPages">¬ª</button>
        </div>
      </div>
    }
  </div>
</div>
